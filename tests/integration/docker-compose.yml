version: "3"

services:
    omnicore:
        image:
            johng12345/omnicore:latest
        volumes:
            - ${PWD}/tests/integration/bitcoin.conf:/root/bitcoin.conf
        expose:
            - "18444"

    omnibolt_alice:
        volumes:
            - ${PWD}/tests/integration/conf.ini.alice:/obd/conf.ini
        build: 
            context: ../..
            dockerfile: ./tests/integration/omnibolt.Dockerfile
        depends_on:
            - omnicore
        expose:
            - 4002
            - 60021

    omnibolt_bob:
        volumes:
            - ${PWD}/tests/integration/conf.ini.bob:/obd/conf.ini
        build: 
            context: ../..
            dockerfile: ./tests/integration/omnibolt.Dockerfile

        expose:
            - 4001
            - 60020
        depends_on:
            - omnicore
    omnitest:
        build: 
            context: .
            dockerfile: Dockerfile
        depends_on: 
            - omnibolt_bob
            - omnibolt_alice
            - omnicore

